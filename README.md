
## åˆ©ç”¨`Puppteer`ç”Ÿæˆå›¾ç‰‡

### Puppteeræ˜¯ä»€ä¹ˆï¼Ÿ
  - æ˜¯ä¸€ä¸ªnodeæ’ä»¶ï¼Œæä¾›äº†ä¸€ç³»åˆ—APIé€šè¿‡ DevTools åè®®æ§åˆ¶ Chromium æˆ– Chromeã€‚ç®€å•æ¥è¯´å°±æ˜¯åœ¨nodeå±‚æ¨¡æ‹Ÿäº†æµè§ˆå™¨
### é‚£å¯ä»¥ç”¨åœ¨å“ªé‡Œï¼Ÿ
  - éœ€è¦ç”Ÿæˆåˆ†äº«å›¾ç‰‡ï¼Œæ‰¹é‡ç”Ÿæˆå›¾ç‰‡æ—¶
  - å›¾ç‰‡å†…æœ‰å¤§é‡çš„åŠ¨æ€æ•°æ®/æ•°æ®ä¾èµ–æœåŠ¡ç«¯æ¥å£
  - å›¾ç‰‡æ•°é‡å¤šï¼Œä¸”æœ‰ä¸€å®šè§„å¾‹æ€§çš„ï¼Œå¯ä»¥é€šè¿‡ä»£ç è€Œä¸ç”¨uiæ‰‹åŠ¨åˆ‡å›¾
  - ä¸¾ä¸ªğŸŒ°ï¼šå‡å¦‚ä½ æ˜¯ä¸€å®¶å…¬å¸çš„è¡Œæ”¿åŒå­¦ï¼Œæ¯å¤©éƒ½è¦åœ¨ç¾¤é‡ŒåŒæ­¥å½“å¤©çš„èœå•æƒ…å†µï¼ˆèœå•æ˜¯å›¾ç‰‡ï¼‰ï¼Œä½ å°±å¯ä»¥é€šè¿‡è¿™ä¸ªæ’ä»¶
  æ¥ç”Ÿæˆã€‚åªéœ€è¦åœ¨è„šæœ¬ä¸­å¡«å…¥æ¯å¤©çš„èœå“å°±å¯ä»¥å¿«é€Ÿçš„ç”Ÿæˆèœå•å•¦

***
> ### Q:ä¸ºä»€ä¹ˆè¦ä½¿ç”¨Puppteerï¼Œæˆ‘ç”¨html/canvasä¹Ÿå¯ä»¥å®ç°å‘€
A: è¿™ä¸ªæ’ä»¶çš„æœ€å¤§å¥½å¤„å°±æ˜¯ä¸å—ç«¯çš„é™åˆ¶ï¼Œç¬”è€…åœ¨å°ç¨‹åºå’ŒRNéƒ½ç¢°åˆ°äº†è¿™ç§æƒ…å†µï¼Œå°¤å…¶æ˜¯å¯¹domå…ƒç´ é™åˆ¶æ¯”è¾ƒä¸¥æ ¼çš„æ¡†æ¶ï¼Œåœ¨è¿™äº›æ¡†æ¶ä¸­æ“ä½œdomæˆ–è€…æ“ä½œcanvasä¸åƒæµè§ˆå™¨çš„htmlä¸€æ ·æ–¹ä¾¿ï¼Œè¿™æ—¶å¯ä»¥é€šè¿‡å¼•å…¥`node`å±‚æ¥è§£å†³ æ˜¯ä¸€ç§æ¯”è¾ƒä¼˜é›…çš„è§£å†³æ–¹æ¡ˆã€‚é€šè¿‡`node`å±‚ç›´æ¥æ“ä½œæµè§ˆå™¨å°±æ²¡æœ‰ä¸ƒä¸ƒå…«å…«çš„é™åˆ¶æ¡ä»¶äº†
ã€‚
***
### ç›®å½•ç»“æ„ï¼š
  - index.html
    - Puppteeréœ€è¦æ‰“å¼€ä¸€ä¸ªæµè§ˆå™¨åœ°å€ï¼Œç„¶åæˆªå›¾ã€‚æˆ‘ä»¬è¦åˆ›å»ºä¸€ä¸ªhtml åœ¨htmlé‡Œè‡ªå®šä¹‰ã€‚å°±å¯ä»¥åŸºäºè¿™ä¸ªhtmlæˆªå›¾äº†
  - index.js
    - ä¸€ä¸ªå¯æ‰§è¡Œè„šæœ¬ å¯ä»¥åœ¨æœ¬åœ°ç”Ÿæˆå›¾ç‰‡
  - server.js
    - åŸºäºkoaçš„serverï¼ŒåŠŸèƒ½å’Œä¸Šè¿°ä¸€æ ·

***

> ## ç®€æ˜“DEMO
  ```js
    // server.js
    const fs = require('fs')
    const puppeteer = require('puppeteer');
    const Router = require('koa-router')
    const router = new Router()

    router.get('/page', async (ctx, next) => {
      const html = fs.readFileSync('./index.html', 'utf-8');
      ctx.body = html
      next()
    })

    router.get('/preview-page', async (ctx, next) => {
      const browser = await puppeteer.launch()
      const page = browser.newPage()
      // ä»¥ iphone Xçš„æœºå‹æ‰“å¼€
      await page.emulate(puppeteer.devices['iPhone X']);
      await page.goto(`localhost:3000/page`)
      // è¿”å›bufferæ ¼å¼çš„å›¾ç‰‡ï¼Œä¹Ÿå¯è§„å®šè¿”å›base64
      // å¦‚æœè¿”å›base64æ ¼å¼æ³¨æ„è¿”å›çš„åªæœ‰æ•°æ® æ²¡æœ‰æ ¼å¼ï¼Œéœ€è¦æ‰‹åŠ¨æ‹¼æ¥
      // ctx.body = `data:image/png;base,${img}`
      const img = await page.screenshot({})
      ctx.type = 'type/image'
      ctx.body = img
    })
  ```

## [æœ«å°¾é™„ä¸­æ–‡æ–‡æ¡£](https://zhaoqize.github.io/puppeteer-api-zh_CN)
